<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রবেশ করুন - ইকোনমিস্ট বিডি</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-js-sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-js-sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-js-sdk.js"></script>

    <style>
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .font-rajdhani { font-family: 'Rajdhani', sans-serif; }
        body { background-color: #050510; }
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.15);
        }
        .neon-text { text-shadow: 0 0 10px rgba(0, 243, 255, 0.8); }
    </style>
</head>
<body class="text-slate-200 font-rajdhani min-h-screen flex items-center justify-center">

    <main class="w-full max-w-md p-6">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-orbitron font-bold text-white tracking-widest neon-text">NEXUS</h1>
            <p class="text-cyan-400 text-sm tracking-[0.3em] uppercase mt-1">Economist BD Portal</p>
        </div>

        <div class="glass-panel rounded-2xl p-8 relative overflow-hidden">
            <!-- Tabs -->
            <div class="flex mb-8 bg-slate-900/50 rounded-lg p-1 border border-slate-700">
                <button id="tab-login" onclick="switchTab('login')" class="flex-1 py-2 rounded-md text-sm font-bold bg-cyan-600 text-white shadow-[0_0_15px_rgba(8,145,178,0.5)] transition-all">
                    লগিন
                </button>
                <button id="tab-signup" onclick="switchTab('signup')" class="flex-1 py-2 rounded-md text-sm font-bold text-slate-400 hover:text-white transition-all">
                    রেজিস্ট্রেশন
                </button>
            </div>

            <div id="msg-box" class="hidden mb-4 p-3 rounded text-xs font-bold text-center"></div>

            <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5">
                <div class="relative">
                    <i class="fas fa-envelope absolute left-4 top-3.5 text-slate-500"></i>
                    <input type="email" id="login-email" required class="w-full bg-slate-800/50 border border-slate-600 py-3 pl-12 pr-4 text-white rounded-lg focus:border-cyan-400 focus:outline-none" placeholder="ইমেইল">
                </div>
                <div class="relative">
                    <i class="fas fa-lock absolute left-4 top-3.5 text-slate-500"></i>
                    <input type="password" id="login-password" required class="w-full bg-slate-800/50 border border-slate-600 py-3 pl-12 pr-4 text-white rounded-lg focus:border-cyan-400 focus:outline-none" placeholder="পাসওয়ার্ড">
                </div>
                <button type="submit" class="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg shadow-[0_0_20px_rgba(8,145,178,0.4)] transition-all">
                    লগিন করুন
                </button>
            </form>

            <form id="signup-form" onsubmit="handleSignup(event)" class="space-y-5 hidden">
                <div class="relative">
                    <i class="fas fa-user absolute left-4 top-3.5 text-slate-500"></i>
                    <input type="text" id="signup-name" required class="w-full bg-slate-800/50 border border-slate-600 py-3 pl-12 pr-4 text-white rounded-lg focus:border-purple-400 focus:outline-none" placeholder="আপনার নাম">
                </div>
                <div class="relative">
                    <i class="fas fa-envelope absolute left-4 top-3.5 text-slate-500"></i>
                    <input type="email" id="signup-email" required class="w-full bg-slate-800/50 border border-slate-600 py-3 pl-12 pr-4 text-white rounded-lg focus:border-purple-400 focus:outline-none" placeholder="ইমেইল">
                </div>
                <div class="relative">
                    <i class="fas fa-lock absolute left-4 top-3.5 text-slate-500"></i>
                    <input type="password" id="signup-password" required class="w-full bg-slate-800/50 border border-slate-600 py-3 pl-12 pr-4 text-white rounded-lg focus:border-purple-400 focus:outline-none" placeholder="পাসওয়ার্ড (কমপক্ষে ৬ অক্ষর)">
                </div>
                <button type="submit" class="w-full py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-lg shadow-[0_0_20px_rgba(192,38,211,0.4)] transition-all">
                    রেজিস্ট্রেশন করুন
                </button>
            </form>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDrQ5Ultpye6h-qpSLFFGDSLFiCkwQKSVo",
            authDomain: "income-58429.firebaseapp.com",
            projectId: "income-58429",
            storageBucket: "income-58429.firebasestorage.app",
            messagingSenderId: "186620112474",
            appId: "1:186620112474:web:90059a7195fb4812f53263"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'default-app-id';

        const initAuth = async () => {
             if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try { await signInWithCustomToken(auth, __initial_auth_token); } catch(e) {}
            }
        };
        initAuth();

        window.switchTab = (tab) => {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginTab = document.getElementById('tab-login');
            const signupTab = document.getElementById('tab-signup');
            const msgBox = document.getElementById('msg-box');
            msgBox.classList.add('hidden');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                loginTab.className = "flex-1 py-2 rounded-md text-sm font-bold bg-cyan-600 text-white shadow-[0_0_15px_rgba(8,145,178,0.5)] transition-all";
                signupTab.className = "flex-1 py-2 rounded-md text-sm font-bold text-slate-400 hover:text-white transition-all";
            } else {
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                signupTab.className = "flex-1 py-2 rounded-md text-sm font-bold bg-purple-600 text-white shadow-[0_0_15px_rgba(192,38,211,0.5)] transition-all";
                loginTab.className = "flex-1 py-2 rounded-md text-sm font-bold text-slate-400 hover:text-white transition-all";
            }
        };

        const showMessage = (msg, type) => {
            const box = document.getElementById('msg-box');
            box.textContent = msg;
            box.classList.remove('hidden', 'bg-red-500/20', 'text-red-300', 'bg-green-500/20', 'text-green-300');
            if(type === 'error') box.classList.add('bg-red-500/20', 'text-red-300');
            else box.classList.add('bg-green-500/20', 'text-green-300');
        };

        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const btn = e.target.querySelector('button');
            const oldText = btn.innerText;

            try {
                btn.innerText = "যাচাই করা হচ্ছে...";
                btn.disabled = true;
                const cred = await signInWithEmailAndPassword(auth, email, password);
                
                showMessage("লগিন সফল! রিডাইরেক্ট করা হচ্ছে...", "success");
                
                if (cred.user.email === 'himel452@gmail.com') {
                    setTimeout(() => window.location.href = "admin.html", 1500);
                } else {
                    setTimeout(() => window.location.href = "index.html", 1500);
                }

            } catch (error) {
                console.error(error);
                let msg = "ত্রুটি হয়েছে";
                if(error.code === 'auth/invalid-credential') msg = "ভুল ইমেইল বা পাসওয়ার্ড";
                showMessage(msg, "error");
                btn.innerText = oldText;
                btn.disabled = false;
            }
        };

        window.handleSignup = async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const btn = e.target.querySelector('button');
            const oldText = btn.innerText;

            try {
                btn.innerText = "অপেক্ষা করুন...";
                btn.disabled = true;

                const cred = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(cred.user, { displayName: name });

                try {
                    await setDoc(doc(db, 'artifacts', appId, 'users', cred.user.uid, 'profile', 'data'), {
                        name: name,
                        email: email,
                        role: 'user',
                        joined: new Date().toISOString()
                    });
                } catch(err) { console.log("Firestore write skipped perms"); }

                showMessage("রেজিস্ট্রেশন সফল! লগিন করা হচ্ছে...", "success");
                setTimeout(() => window.location.href = "index.html", 1500);

            } catch (error) {
                console.error(error);
                let msg = "রেজিস্ট্রেশন ব্যর্থ";
                if(error.code === 'auth/email-already-in-use') msg = "এই ইমেইল ইতিমধ্যে ব্যবহৃত";
                if(error.code === 'auth/weak-password') msg = "পাসওয়ার্ড দুর্বল (কমপক্ষে ৬ অক্ষর)";
                showMessage(msg, "error");
                btn.innerText = oldText;
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
