<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economist BD - Nexus Access</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Orbitron for Sci-Fi headers, Rajdhani for tech text -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-js-sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-js-sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-js-sdk.js"></script>

    <style>
        /* Custom Fonts */
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .font-rajdhani { font-family: 'Rajdhani', sans-serif; }

        /* Animated Background */
        body {
            background-color: #050510;
            overflow: hidden;
        }

        .bg-grid {
            background-image: 
                linear-gradient(rgba(0, 255, 242, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 242, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            perspective: 500px;
            transform-style: preserve-3d;
            animation: moveGrid 20s linear infinite;
        }

        @keyframes moveGrid {
            0% { transform: translateY(0) rotateX(20deg); }
            100% { transform: translateY(40px) rotateX(20deg); }
        }

        /* Glowing Orbs */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float 10s infinite ease-in-out;
        }
        .orb-1 { width: 300px; height: 300px; background: #00f3ff; top: -100px; left: -100px; animation-delay: 0s; }
        .orb-2 { width: 400px; height: 400px; background: #bc13fe; bottom: -100px; right: -100px; animation-delay: -5s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, 50px); }
        }

        /* Glass Card */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.15), inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        /* Neon Text & Borders */
        .neon-text-cyan {
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.8), 0 0 20px rgba(0, 243, 255, 0.4);
        }
        .neon-border-focus:focus-within {
            border-color: #00f3ff;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
        }

        /* Glitch Effect on Hover */
        .glitch-btn {
            position: relative;
            overflow: hidden;
        }
        .glitch-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        .glitch-btn:hover::before {
            left: 100%;
        }

        /* Form Transition */
        .form-container {
            transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out;
        }
        .hidden-form {
            display: none;
            opacity: 0;
            transform: translateX(50px);
        }
        .visible-form {
            display: block;
            opacity: 1;
            transform: translateX(0);
            animation: slideIn 0.5s forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050510; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }
    </style>
</head>
<body class="text-slate-200 font-rajdhani min-h-screen flex items-center justify-center relative">

    <!-- Background Elements -->
    <div class="fixed inset-0 bg-grid z-0"></div>
    <div class="orb orb-1 z-0"></div>
    <div class="orb orb-2 z-0"></div>

    <!-- Main Container -->
    <main class="relative z-10 w-full max-w-md p-6">
        
        <!-- Logo / Branding -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-orbitron font-bold text-white tracking-widest neon-text-cyan">
                NEXUS
            </h1>
            <p class="text-cyan-400 text-sm tracking-[0.3em] uppercase mt-1 opacity-80">Economist BD Portal</p>
        </div>

        <!-- Glass Card -->
        <div class="glass-panel rounded-2xl p-8 relative overflow-hidden">
            
            <!-- Decorative scanline at top -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-70"></div>

            <!-- Tabs -->
            <div class="flex mb-8 bg-slate-900/50 rounded-lg p-1 border border-slate-700">
                <button id="tab-login" onclick="switchTab('login')" class="flex-1 py-2 rounded-md text-sm font-bold tracking-wider transition-all duration-300 bg-cyan-600 text-white shadow-[0_0_15px_rgba(8,145,178,0.5)]">
                    ACCESS
                </button>
                <button id="tab-signup" onclick="switchTab('signup')" class="flex-1 py-2 rounded-md text-sm font-bold tracking-wider text-slate-400 hover:text-white transition-all duration-300">
                    JOIN
                </button>
            </div>

            <!-- Error Message Box -->
            <div id="error-box" class="hidden mb-4 p-3 rounded bg-red-500/10 border border-red-500/50 text-red-200 text-xs flex items-center gap-2">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="error-msg">Error text goes here</span>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="form-container visible-form space-y-5" onsubmit="handleLogin(event)">
                <div class="group">
                    <label class="block text-xs uppercase tracking-widest text-slate-400 mb-1 ml-1 group-focus-within:text-cyan-400 transition-colors">Digital ID (Email)</label>
                    <div class="relative neon-border-focus rounded-lg border border-slate-600 bg-slate-800/50 transition-all duration-300">
                        <i class="fas fa-envelope absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"></i>
                        <input type="email" id="login-email" required class="w-full bg-transparent py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none rounded-lg font-mono" placeholder="user@economist.bd">
                    </div>
                </div>

                <div class="group">
                    <label class="block text-xs uppercase tracking-widest text-slate-400 mb-1 ml-1 group-focus-within:text-cyan-400 transition-colors">Access Code (Password)</label>
                    <div class="relative neon-border-focus rounded-lg border border-slate-600 bg-slate-800/50 transition-all duration-300">
                        <i class="fas fa-lock absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"></i>
                        <input type="password" id="login-password" required class="w-full bg-transparent py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none rounded-lg font-mono" placeholder="••••••••">
                    </div>
                </div>

                <div class="flex justify-between items-center text-xs text-cyan-400/80">
                    <label class="flex items-center cursor-pointer hover:text-cyan-300">
                        <input type="checkbox" class="mr-2 accent-cyan-500 bg-slate-800 border-slate-600 rounded"> Remember Signal
                    </label>
                    <a href="#" class="hover:text-white transition-colors decoration-dashed underline underline-offset-4">Lost Key?</a>
                </div>

                <button type="submit" class="glitch-btn w-full py-3.5 mt-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-orbitron font-bold tracking-widest rounded-lg shadow-[0_0_20px_rgba(8,145,178,0.4)] transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                    INITIALIZE LOGIN
                </button>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="form-container hidden-form space-y-5" onsubmit="handleSignup(event)">
                <div class="group">
                    <label class="block text-xs uppercase tracking-widest text-slate-400 mb-1 ml-1 group-focus-within:text-purple-400 transition-colors">Designation (Name)</label>
                    <div class="relative neon-border-focus rounded-lg border border-slate-600 bg-slate-800/50 transition-all duration-300 focus-within:border-purple-500 focus-within:shadow-[0_0_15px_rgba(192,38,211,0.5)]">
                        <i class="fas fa-user absolute left-4 top-3.5 text-slate-500 group-focus-within:text-purple-400 transition-colors"></i>
                        <input type="text" id="signup-name" required class="w-full bg-transparent py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none rounded-lg font-mono" placeholder="Agent Name">
                    </div>
                </div>

                <div class="group">
                    <label class="block text-xs uppercase tracking-widest text-slate-400 mb-1 ml-1 group-focus-within:text-purple-400 transition-colors">Digital ID (Email)</label>
                    <div class="relative neon-border-focus rounded-lg border border-slate-600 bg-slate-800/50 transition-all duration-300 focus-within:border-purple-500 focus-within:shadow-[0_0_15px_rgba(192,38,211,0.5)]">
                        <i class="fas fa-envelope absolute left-4 top-3.5 text-slate-500 group-focus-within:text-purple-400 transition-colors"></i>
                        <input type="email" id="signup-email" required class="w-full bg-transparent py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none rounded-lg font-mono" placeholder="new.agent@economist.bd">
                    </div>
                </div>

                <div class="group">
                    <label class="block text-xs uppercase tracking-widest text-slate-400 mb-1 ml-1 group-focus-within:text-purple-400 transition-colors">Set Access Code</label>
                    <div class="relative neon-border-focus rounded-lg border border-slate-600 bg-slate-800/50 transition-all duration-300 focus-within:border-purple-500 focus-within:shadow-[0_0_15px_rgba(192,38,211,0.5)]">
                        <i class="fas fa-lock absolute left-4 top-3.5 text-slate-500 group-focus-within:text-purple-400 transition-colors"></i>
                        <input type="password" id="signup-password" required class="w-full bg-transparent py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none rounded-lg font-mono" placeholder="••••••••">
                    </div>
                </div>

                <button type="submit" class="glitch-btn w-full py-3.5 mt-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-orbitron font-bold tracking-widest rounded-lg shadow-[0_0_20px_rgba(192,38,211,0.4)] transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                    ESTABLISH LINK
                </button>
            </form>

            <!-- Social/Divider -->
            <div class="mt-8 relative text-center">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-slate-700"></div>
                </div>
                <span class="relative bg-[#0f1522] px-2 text-xs text-slate-500 uppercase tracking-widest">Or Authenticate With</span>
            </div>

            <div class="flex gap-4 mt-6">
                <button class="flex-1 py-2 rounded border border-slate-700 hover:border-cyan-500 hover:bg-slate-800/80 transition-all duration-300 text-slate-400 hover:text-white hover:shadow-[0_0_10px_rgba(0,243,255,0.2)]">
                    <i class="fab fa-google"></i>
                </button>
                <button class="flex-1 py-2 rounded border border-slate-700 hover:border-purple-500 hover:bg-slate-800/80 transition-all duration-300 text-slate-400 hover:text-white hover:shadow-[0_0_10px_rgba(192,38,211,0.2)]">
                    <i class="fab fa-github"></i>
                </button>
            </div>

            <!-- Footer Stats Mockup -->
            <div class="mt-8 pt-4 border-t border-slate-700/50 flex justify-between text-[10px] text-slate-500 font-mono">
                <span>SYS.STATUS: <span class="text-green-400">ONLINE</span></span>
                <span>SECURE: <span class="text-green-400">ENCRYPTED</span></span>
            </div>
        </div>

        <div class="text-center mt-6 opacity-40 text-xs">
            &copy; 2025 ECONOMIST BD. ALL RIGHTS RESERVED.
        </div>
    </main>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut, signInWithCustomToken, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- Configuration ---
        // Uses environment variables for Preview. 
        // Replace with your own firebaseConfig object if hosting externally.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "demo-key",
            authDomain: "demo.firebaseapp.com",
            projectId: "demo-project"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Helper: Auth Setup for Preview Environment ---
        // This ensures the preview works even if the user hasn't typed anything yet
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token");
                } catch (e) {
                    console.error("Token sign-in failed", e);
                }
            } else {
                // We don't force anonymous sign-in here because we want the user to USE the login form
                // But we listen to auth state
            }
        };
        initAuth();

        // --- UI Functions ---
        
        // Expose function to window for HTML onclick attributes
        window.switchTab = (tab) => {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginTab = document.getElementById('tab-login');
            const signupTab = document.getElementById('tab-signup');
            const errorBox = document.getElementById('error-box');

            errorBox.classList.add('hidden'); // Clear errors on switch

            if (tab === 'login') {
                loginForm.classList.remove('hidden-form');
                loginForm.classList.add('visible-form');
                signupForm.classList.remove('visible-form');
                signupForm.classList.add('hidden-form');
                
                // Style Tabs
                loginTab.classList.add('bg-cyan-600', 'text-white', 'shadow-[0_0_15px_rgba(8,145,178,0.5)]');
                loginTab.classList.remove('text-slate-400');
                
                signupTab.classList.remove('bg-purple-600', 'text-white', 'shadow-[0_0_15px_rgba(192,38,211,0.5)]');
                signupTab.classList.add('text-slate-400');
                
                // Slight timeout for display none to allow animation
                setTimeout(() => {
                   if(tab === 'login') signupForm.style.display = 'none';
                }, 500);
                loginForm.style.display = 'block';

            } else {
                signupForm.classList.remove('hidden-form');
                signupForm.classList.add('visible-form');
                loginForm.classList.remove('visible-form');
                loginForm.classList.add('hidden-form');

                // Style Tabs
                signupTab.classList.add('bg-purple-600', 'text-white', 'shadow-[0_0_15px_rgba(192,38,211,0.5)]');
                signupTab.classList.remove('text-slate-400');

                loginTab.classList.remove('bg-cyan-600', 'text-white', 'shadow-[0_0_15px_rgba(8,145,178,0.5)]');
                loginTab.classList.add('text-slate-400');

                setTimeout(() => {
                   if(tab === 'signup') loginForm.style.display = 'none';
                }, 500);
                signupForm.style.display = 'block';
            }
        };

        const showError = (msg) => {
            const errorBox = document.getElementById('error-box');
            const errorMsg = document.getElementById('error-msg');
            errorMsg.textContent = msg;
            errorBox.classList.remove('hidden');
        };

        const showSuccess = (msg) => {
             const errorBox = document.getElementById('error-box');
             const errorMsg = document.getElementById('error-msg');
             errorBox.classList.remove('bg-red-500/10', 'border-red-500/50', 'text-red-200');
             errorBox.classList.add('bg-green-500/10', 'border-green-500/50', 'text-green-200');
             errorMsg.textContent = msg;
             errorBox.classList.remove('hidden');
        }

        // --- Logic: Login ---
        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;

            try {
                btn.innerText = "AUTHENTICATING...";
                btn.disabled = true;
                
                // Firebase Login
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                
                showSuccess("ACCESS GRANTED. WELCOME BACK, AGENT.");
                console.log("Logged in:", userCredential.user);

                // Optional: Redirect logic would go here
                // window.location.href = "/dashboard";
                
            } catch (error) {
                console.error(error);
                let msg = "AUTHENTICATION FAILED";
                if (error.code === 'auth/invalid-credential') msg = "INVALID CREDENTIALS";
                if (error.code === 'auth/user-not-found') msg = "DIGITAL ID NOT FOUND";
                if (error.code === 'auth/wrong-password') msg = "ACCESS CODE INCORRECT";
                showError(msg);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        // --- Logic: Signup ---
        window.handleSignup = async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;

            try {
                btn.innerText = "ESTABLISHING LINK...";
                btn.disabled = true;

                // Firebase Signup
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Update Profile Name
                await updateProfile(user, { displayName: name });

                // Save user data to Firestore (Example of persistence)
                // Using the strict path rule: /artifacts/{appId}/users/{userId}/profile/data
                await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'), {
                    name: name,
                    email: email,
                    role: 'agent',
                    joined: new Date().toISOString()
                });

                showSuccess("LINK ESTABLISHED. WELCOME, " + name.toUpperCase());
                console.log("Signed up:", user);

            } catch (error) {
                console.error(error);
                let msg = "CONNECTION ERROR";
                if (error.code === 'auth/email-already-in-use') msg = "ID ALREADY ACTIVE";
                if (error.code === 'auth/weak-password') msg = "ACCESS CODE TOO WEAK";
                showError(msg);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        // --- Auth State Observer ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User state: Signed In", user.email);
                // If you wanted to auto-hide the form on login, you could do it here
            } else {
                console.log("User state: Signed Out");
            }
        });

    </script>
</body>
</html>
